name: Create Release Zip

on:
    push:
    workflow_dispatch:

jobs:
    create-release:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Create skill directory structure
              run: |
                  mkdir -p splunkbase-skill
                  cp get_splunkbase_urls.sh splunkbase-skill/
                  cp README.md splunkbase-skill/
                  cp SKILL.md splunkbase-skill/
                  cp splunkbase_urls.py splunkbase-skill/

            - name: Create zip archive
              run: |
                  zip -r splunkbase-skill.zip splunkbase-skill/
                  ls -lh splunkbase-skill.zip

            - name: Upload artifact
              uses: actions/upload-artifact@v4
              with:
                  name: splunkbase-skill-archive
                  path: splunkbase-skill.zip
                  retention-days: 90

            - name: Create tag
              run: |
                  git config user.name "github-actions"
                  git config user.email "github-actions@github.com"
                  git tag -f latest
                  git push origin -f --tags
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

            - name: Create Release
              uses: softprops/action-gh-release@v1
              with:
                  files: splunkbase-skill.zip
                  draft: false
                  prerelease: false
                  generate_release_notes: true
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
